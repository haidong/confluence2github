:::::::::::: {#page}
:::::::: {#main .aui-page-panel}
:::: {#main-header}
::: {#breadcrumb-section}
1.  [Alex Ji](index.html)
2.  [Alex Ji's Home](377815074.html)
3.  [Moving FA demo apps to CI/CD](378603116.html)
:::

# [ Alex Ji : Using WebEx Bot for CI/CD ]{#title-text} {#title-heading .pagetitle}
::::

::::: {#content .view}
::: page-metadata
Created by [ Alex Ji]{.author} on Mar 23, 2024
:::

::: {#main-content .wiki-content .group}
Since WebEx is a Cisco product and used internally, it is very useful to
incorporate it into our CI/CD workflow.

It is used in the following areas:

-   aws CodeCommit repo push notification
-   PR (Pull Request) merge notification
-   Kubernetes clusters reinstall on demand
-   Get token to access chaos-mesh dashboard
-   More to come

This article discusses the steps and techniques used to make it happen.

## Create a WebEx bot and add it to the WebEx Spaces {#UsingWebExBotforCI/CD-CreateaWebExbotandaddittotheWebExSpaces}

Go to
[https://developer.webex.com/my-apps/new](https://developer.webex.com/my-apps/new){.external-link
rel="nofollow"} and create a bot. Once created, you will see it listed
under
[https://developer.webex.com/my-apps](https://developer.webex.com/my-apps){.external-link
rel="nofollow"} page. You can go to the bot\'s page to generate access
token, check its id, and so forth. The access token and ID will be
useful to create webhooks discussed below.

After a bot is created, you can add it to WebEx Spaces/Rooms. From
inside a room, you can write webhooks that supports interaction with the
bot.

\

## Webhook and lambda functions {#UsingWebExBotforCI/CD-Webhookandlambdafunctions}

CI/CD activities are typically triggered via webhooks. Webhook is an
HTTP-based callback function that answers to certain events. In our
case, behind the Webhook are AWS lambda functions.

### aws lambda functions {#UsingWebExBotforCI/CD-awslambdafunctions}

Because our source code repo resides on AWS CodeCommit, so naturally aws
lambda functions are used to support webhooks. We use AWS SAM
(Serverless Application Model) toolkit to write, test, and deploy lambda
functions.
[https://us-west-2.console.aws.amazon.com/codesuite/codecommit/repositories/demo_team_aws_lambda/browse?region=us-west-2](https://us-west-2.console.aws.amazon.com/codesuite/codecommit/repositories/demo_team_aws_lambda/browse?region=us-west-2){.external-link
rel="nofollow"}

Currently, one of the main lambdas is the WebBotFunction, where it
responds to our various requests in our team\'s WebEx Room. All code,
including roles governing various permissions needed by the lambda, is
in the project repo.

### webhook creation {#UsingWebExBotforCI/CD-webhookcreation}

The following is needed:

-   The WebEx bot access token
-   The URL of the webhook. Use the URL generated by our project. It is
    displayed after the SAM deployment.

The webhook needs a proper filter, because we don\'t want to allow
anybody to have the ability of calling the WebEx bot and sending
commands. The filter is typically a combination of the bot\'s ID and
RoomID. Below is an example:

curl -X POST \"https://webexapis.com/v1/webhooks\" \\\
-H \"Authorization: Bearer MySecretToken\" \\\
-H \"Content-Type: application/json\" \\\
-d \'{\
\"name\": \"webex message debugging\",\
\"targetUrl\":
\"https://4chd2kc1d7.execute-api.us-west-2.amazonaws.com/Prod/webex_bot\",\
\"resource\": \"messages\",\
\"event\": \"created\",\
\"filter\":
\"mentionedPeople=Y2lzY29zcGFyazovL3VzL1BFT1BMRS8yMzUyYWQwZi04NjQ0LTQ2YWItYmQ1ZC1jYjI5YjI3MzM2NTM&roomId=Y2lzY29zcGFyazovL3VzL1JPT00vOGE3MjU3NTAtOTQ1ZS0xMWVlLWE3ZDQtYTMzNzFiYTY0Mzkz\"\
}\'

## Additional notes {#UsingWebExBotforCI/CD-Additionalnotes}

-   The bot is easier to code with simple tagging, then followed by a
    verb indicating actions to take, then target and various other
    parameters. Richer interactions with the bot is possible via
    Adaptive Cards, but that requires more designing, coding, and
    testing work. We currently use Adaptive Card in one scenario: k8s
    cluster reinstall.
-   In almost all cases, the filter clause needs more than just RoomID,
    except perhaps for Adaptive Card. I learned it the hard way: your
    webhook will fire constantly if the only filter is RoomID, and will
    eventually be disabled because of rate limit.
    -   If your webhook is disabled, it is easier to delete it. Then
        recreate.
:::
:::::
::::::::

::::: {#footer role="contentinfo"}
:::: {.section .footer-body}
Document generated by Confluence on May 22, 2024 14:04

::: {#footer-logo}
[Atlassian](https://www.atlassian.com/)
:::
::::
:::::
::::::::::::
